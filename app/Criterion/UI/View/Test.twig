{% extends 'Layout.twig' %}

{% block content %}

    {% if test.status.code == '3' or test.status.code == '4' %}
        <meta http-equiv="refresh" content="1">
    {% endif %}

    <h1 class="lead">{{ project.repo }}
        {% if test.status.code == '1' %}
            {% set status_label = 'success' %}
        {% elseif test.status.code == '4' %}
            {% set status_label = 'info' %}
        {% elseif test.status.code == '3' %}
            {% set status_label = 'warning' %}
        {% elseif test.status.code == '0' %}
            {% set status_label = 'important' %}
        {% endif %}
        <span class="label label-{{ status_label }}">{{ test.status.message }}</span>
    </h1>

    <hr />

    <table class="table well">
        <thead>
            <tr>
                <th>Commit</th>
                <th>Author</th>
                <th>Branch</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{% if test.commit is defined %} {{test.commit.hash.short}}  {% else %} N/A {% endif %}</td>
                <td>{% if test.commit is defined %} {{test.commit.author.name}}  {% else %} N/A {% endif %}</td>
                <td>{% if test.commit is defined %} {{test.branch}}  {% else %} N/A {% endif %}</td>
                <td>{{ test.started.sec|date('H:i - jS F Y') }}</td>
            </tr>
        </tbody>
    </table>

    <hr />

    <h1 class="lead">Logs</h1>
    {% for item in log %}
        <div>
            <a href="javascript:void(0)" class="output-log">
                {% if item.response == 0 %}
                    <p class="alert alert-success">{{ item.command }}</p>
                {% else %}
                    <p class="alert alert-danger">{{ item.command }}</p>
                {% endif %}
            </a>

            <div class="well well-small {% if item.response == 0 %} hide {% endif %}">
                {% if item.output %}
                    {{ item.output|nl2br }}
                {% else %}
                    There was no output from this command.
                {% endif %}
            </div>

        </div>
    {% else %}
        <p class="alert alert-info">There are no logs for this test yet</p>
    {% endfor %}

    <script>
        $(document).ready(function() {
            $('.output-log').on('click', function(){
                $(this).next().toggle();
            });
        });
    </script>

{% endblock %}
